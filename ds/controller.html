<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controller</title>
    <style>
        /* Style setup here as per previous design */
    </style>
</head>
<body>
    <h1>Control Status</h1>
    <div class="status-buttons">
        <!-- Add buttons for changing the status -->
        <button onclick="updateStatus('available')">Available</button>
        <button onclick="updateStatus('busy')">Busy</button>
        <button onclick="updateStatus('DO NOT DISTURB')">Do Not Disturb</button>
        <button onclick="updateStatus('meeting')">Meeting</button>
    </div>

    <script>
        const githubToken = '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'; // Your personal GitHub token
        const repoOwner = 'glpdtech@gmai.com'; // Your GitHub username
        const repoName = 'it'; // Your repository name
        const filePath = 'status.json'; // Path to the JSON file in your repository

        // Function to update the status
        function updateStatus(status) {
            const apiUrl = `https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`;

            // Fetch the current content of the status.json file to get the sha for updating
            fetch(apiUrl)
                .then(response => response.json())
                .then(data => {
                    const sha = data.sha; // Get the sha of the file
                    const updateData = {
                        message: `Update status to ${status}`,
                        committer: {
                            name: "glpdtech",
                            email: "glpdtech@gmail.com"
                        },
                        content: btoa(JSON.stringify({ status: status })), // Convert JSON to Base64
                        sha: sha
                    };

                    // Send a PUT request to GitHub API to update the file
                    fetch(apiUrl, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify(updateData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        alert('Status updated to ' + status);
                    })
                    .catch(err => {
                        console.error('Error updating the status:', err);
                        alert('Failed to update status');
                    });
                })
                .catch(err => {
                    console.error('Error fetching the file content:', err);
                    alert('Failed to retrieve file for update');
                });
        }
    </script>
</body>
</html>
